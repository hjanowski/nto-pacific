<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTO Pacific | Premium Diving Equipment</title>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js" defer></script>
    <!-- Salesforce Interactions SDK -->
    <script src="https://cdn.c360a.salesforce.com/beacon/c360a/233a8f36-3f93-4e01-84e5-c210837a6c97/scripts/c360a.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>NTO Pacific</h1>
                <p>Premium Diving Equipment</p>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active">Home</a></li>
                    <li><a href="catalog.html">Shop</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <button id="cart-btn" class="btn-icon"><span class="cart-count">0</span>ðŸ›’</button>
                <button id="login-btn" class="btn-primary">Login</button>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h2>Explore the Depths</h2>
                <p>Professional diving equipment for every adventure</p>
                <button class="btn-primary btn-large" id="shop-now-btn">Shop Now</button>
            </div>
        </div>
    </section>

    <section class="featured-products">
        <div class="container">
            <h2 class="section-title">Featured Equipment</h2>
            <div class="products-grid">
                <!-- Product cards as before -->
                <div class="product-card" data-product-id="1" data-product-name="Elite Pro Diving Mask" data-product-price="129.99" data-in-stock="true">
                    <div class="product-image"></div>
                    <h3>Elite Pro Diving Mask</h3>
                    <p class="product-price">$129.99</p>
                    <button class="btn-secondary add-to-cart">Add to Cart</button>
                </div>
                <!-- ... other products ... -->
            </div>
        </div>
    </section>

    <section class="collection-banner">
        <div class="container">
            <div class="banner-content">
                <h2>New 2025 Collection</h2>
                <p>Engineered for the deepest dives</p>
                <button class="btn-primary">Explore Collection</button>
            </div>
        </div>
    </section>

    <section>
        <div class="container">
            <form id="newsletter-form">
                <input type="email" placeholder="Your email" required>
                <button type="submit" class="btn-primary">Subscribe</button>
            </form>
        </div>
    </section>

    <footer>
        <!-- footer content as before -->
        <div class="container">
            <p>Â© 2025 NTO Pacific. All rights reserved.</p>
        </div>
    </footer>

    <!-- Logging UI (optional) -->
    <div id="api-status" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: #fff; padding: 8px; border-radius: 4px; font-size: 12px;">Initializing...</div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const MAX_CHECKS = 20;
        let checks = 0;
        let apiAvailable = false;
        let consentInitialized = false;
        let identitySent = false;

        const statusEl = document.getElementById('api-status');
        function updateStatus(msg, isError) {
            statusEl.textContent = msg;
            statusEl.style.background = isError ? 'rgba(150, 0, 0, 0.8)' : 'rgba(0, 100, 0, 0.8)';
        }
        function log(msg, isError) {
            console[isError ? 'error' : 'log']('[SF Interactions] ' + msg);
        }

        function checkApi() {
            log('Checking for SalesforceInteractions...');
            if (window.SalesforceInteractions &&
                typeof window.SalesforceInteractions.sendEvent === 'function') {
                apiAvailable = true;
                updateStatus('Salesforce Interactions SDK loaded');
                initializeAndIdentify();
            } else {
                apiAvailable = false;
                updateStatus(`SDK not found (attempt ${checks}/${MAX_CHECKS})`, true);
            }
        }

        function initializeAndIdentify() {
            if (consentInitialized) return;
            window.SalesforceInteractions.init({
                consents: [{ provider: 'CampaignAttribution', purpose: 'Tracking', status: 'Opt In' }]
            }).then(res => {
                log('Consent init successful');
                consentInitialized = true;
                sendIdentityEvent();
            }).catch(err => {
                log('Consent init error: ' + JSON.stringify(err), true);
                updateStatus('Consent init failed', true);
            });
        }

        function sendIdentityEvent() {
            if (identitySent) return;
            window.SalesforceInteractions.sendEvent({
                user: {
                    attributes: {
                        eventType: 'identity',
                        firstName: '',
                        lastName: '',
                        email: '',
                        isAnonymous: 0
                    }
                }
            }).then(res => {
                log('Identity event sent');
                identitySent = true;
                updateStatus('Ready to send interaction events');
            }).catch(err => {
                log('Identity event error: ' + JSON.stringify(err), true);
                updateStatus('Identity event failed', true);
            });
        }

        function retryCheck() {
            if (apiAvailable || checks >= MAX_CHECKS) return;
            checks++;
            setTimeout(() => {
                checkApi();
                retryCheck();
            }, 1000);
        }

        // Start the SDK check loop
        setTimeout(() => { checkApi(); retryCheck(); }, 1000);

        // Add-to-cart event wiring
        document.querySelectorAll('.add-to-cart').forEach(btn => {
            btn.addEventListener('click', function() {
                const card = this.closest('.product-card');
                const productName = card.dataset.productName;
                if (!apiAvailable || !consentInitialized || !identitySent) {
                    log('Cannot send event yet â€“ SDK or consent/identity not ready', true);
                    return;
                }
                const params = new URLSearchParams(window.location.search);
                const utm_source = params.get('utm_source') || 'Meta Ads';
                const utm_campaign = params.get('utm_campaign') || 'DefaultCampaign';
                const utm_content = params.get('utm_content') || 'DefaultContent';
                const timestamp = new Date().toISOString();

                window.SalesforceInteractions.sendEvent({
                    interaction: {
                        name: 'Campaigns Events',
                        eventType: 'campaignsEvents',
                        campaignName: utm_campaign,
                        campaignSource: utm_source,
                        campaignContent: utm_content,
                        custom1: 'product_add_to_cart',
                        custom2: productName,
                        custom3: timestamp
                    }
                }).then(res => {
                    log('Add-to-cart event sent');
                }).catch(err => {
                    log('Add-to-cart error: ' + JSON.stringify(err), true);
                });
            });
        });

        // Newsletter signup event wiring
        const newsletterForm = document.getElementById('newsletter-form');
        if (newsletterForm) {
            newsletterForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const emailInput = this.querySelector('input[type="email"]');
                const email = emailInput.value;

                if (!apiAvailable || !consentInitialized || !identitySent) {
                    log('Cannot send event yet â€“ SDK or consent/identity not ready', true);
                    alert('Thank you for subscribing!');
                    emailInput.value = '';
                    return;
                }
                const params = new URLSearchParams(window.location.search);
                const utm_source = params.get('utm_source') || 'Meta Ads';
                const utm_campaign = params.get('utm_campaign') || 'DefaultCampaign';
                const utm_content = params.get('utm_content') || 'DefaultContent';
                const timestamp = new Date().toISOString();

                window.SalesforceInteractions.sendEvent({
                    interaction: {
                        name: 'Campaigns Events',
                        eventType: 'campaignsEvents',
                        campaignName: utm_campaign,
                        campaignSource: utm_source,
                        campaignContent: utm_content,
                        custom1: 'Newsletter Signup',
                        custom2: 'Homepage Newsletter',
                        custom3: timestamp
                    }
                }).then(res => {
                    log('Newsletter event sent');
                    alert('Thank you for subscribing!');
                }).catch(err => {
                    log('Newsletter error: ' + JSON.stringify(err), true);
                    alert('Thank you for subscribing!');
                }).finally(() => {
                    emailInput.value = '';
                });
            });
        }

        // Shop Now button
        const shopNowBtn = document.getElementById('shop-now-btn');
        if (shopNowBtn) {
            shopNowBtn.addEventListener('click', () => window.location.href = 'catalog.html');
        }
    });
    </script>
</body>
</html>
